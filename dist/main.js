!function(e){var t={};function n(i){if(t[i])return t[i].exports;var a=t[i]={i:i,l:!1,exports:{}};return e[i].call(a.exports,a,a.exports,n),a.l=!0,a.exports}n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(i,a,function(t){return e[t]}.bind(null,a));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";n.r(t);var i=!0,a=[],s=null,r=function(e){for(var t={},n=0;n<e.length;n++){var i=e[n];t[i.class]=i}return t}(DECK_DEFINITIONS),l={MODIFIER:"modifier",ABILITY:"ability",BOSS:"boss"},c={MODIFIER_CARD_DRAWN:"modifierCardDrawn",MODIFIER_DECK_SHUFFLE_REQUIRED:"modfierDeckShuffleRequired"};function d(e,t){var n={};return n.back=t,n.front=e,n.flip_up=function(e){toggle_class(this.back,"up",!e),toggle_class(this.back,"down",e),toggle_class(this.front,"up",e),toggle_class(this.front,"down",!e)},n.set_depth=function(e){this.back.style.zIndex=e,this.front.style.zIndex=e},n.push_down=function(){this.back.style.zIndex-=1,this.front.style.zIndex-=1},n.addClass=function(e){this.front.classList.add(e),this.back.classList.add(e)},n.removeClass=function(e){this.front.classList.remove(e),this.back.classList.remove(e)},n.attach=function(e){e.appendChild(this.back),e.appendChild(this.front)},n.flip_up(!1),n}function o(e,t){var n=document.createElement("div");n.className="card ability back down";var i=document.createElement("span");return i.className="name",i.innerText=e+"-"+t,n.appendChild(i),n}function u(e,t,n,i,a,s,r,l,c){var d=document.createElement("div");d.className="card ability front down";var o=document.createElement("span");o.className="name",o.innerText=t+"-"+l,d.appendChild(o);var u=document.createElement("span");if(u.className="healthNormal",u.innerText="HP "+c[0],d.appendChild(u),c[1]>0){var _=document.createElement("span");_.className="healthElite",_.innerText="HP "+c[1],d.appendChild(_)}var m=document.createElement("span");if(m.className="initiative",m.innerText=e,d.appendChild(m),n){var f=document.createElement("img");f.src="images/shuffle.svg",d.appendChild(f)}var h=0,p=d;i=remove_empty_strings(i);for(var v=0;v<i.length;v++){for(var g=i[v],E=0;g.indexOf("*")>=0;)E+=1,g=g.substr(1);for(var b=E-h;h!=E;)if(b>0){var k=document.createElement("ul");i.length>5&&(k.style.fontSize=100-2.5*i.length+"%"),p.appendChild(k),p=k;var S=document.createElement("li");p.appendChild(S),p=S,h+=1}else p=(p=p.parentElement).parentElement,h-=1;if(h>0&&b<=0){p=p.parentElement;S=document.createElement("li");p.appendChild(S),p=S}var C=expand_string(g.trim(),a,s,r);p.insertAdjacentHTML("beforeend",C)}return d}function _(e,t,n){var a=r[e];a.name=t,a.level=n;for(var s=JSON.parse(get_from_storage(t)),c={class:a.class,name:a.name,type:l.ABILITY,draw_pile:[],discard:[],move:[0,0],attack:[0,0],range:[0,0],level:a.level,health:[0,0]},_=0;_<a.cards.length;_++){var m=a.cards[_],h=m[0],p=m[1],v=m.slice(2),g=document.createElement("div");g.className="card ability front down";var E=g,b=o(c.name,c.level),k={id:c.name+"_"+_,ui:new d(E,b),shuffle_next:h,initiative:p,starting_lines:v,paint_front_card:function(e,t,n,i,a,s,r){this.ui.front=u(this.initiative,e,this.shuffle_next,t,n,i,a,s,r)}};s&&find_in_discard(s.discard,k.id)?c.discard.push(k):c.draw_pile.push(k)}return c.draw_top_discard=function(){if(this.discard.length>0){var e=this.discard[this.discard.length-1],t=e.starting_lines,n=[];if(this.is_boss()){var i=[];t.forEach((function(e){i=i.concat(special_to_lines(e,c.special1,c.special2))})),t=i,this.immunities&&(n=n.concat(immunities_to_lines(this.immunities))),this.notes&&(n=n.concat(notes_to_lines(this.notes)))}else this.attributes&&(n=n.concat(attributes_to_lines(this.attributes)));e.paint_front_card(this.get_real_name(),t.concat(n),this.attack,this.move,this.range,this.level,this.health),e.ui.set_depth(-3),e.ui.addClass("pull"),e.ui.flip_up(!0),e.ui.removeClass("draw"),e.ui.addClass("discard")}f(this)},c.draw_top_card=function(){var e=this.draw_pile[0].starting_lines,t=[];if(this.is_boss()){var n=[];e.forEach((function(e){n=n.concat(special_to_lines(e,c.special1,c.special2))})),e=n,this.immunities&&(t=t.concat(immunities_to_lines(this.immunities))),this.notes&&(t=t.concat(notes_to_lines(this.notes)))}else this.attributes&&(t=t.concat(attributes_to_lines(this.attributes)));this.draw_pile[0].paint_front_card(this.get_real_name(),e.concat(t),this.attack,this.move,this.range,this.level,this.health),f(this)},c.must_reshuffle=function(){return!this.draw_pile.length||(i&&this.discard.length?this.discard[0].shuffle_next:void 0)},c.set_stats_monster=function(e){this.attack=e.attack,this.move=e.move,this.range=e.range,this.attributes=e.attributes,this.health=e.health},c.set_stats_boss=function(e){this.attack=e.attack,this.move=e.move,this.range=e.range,this.special1=e.special1,this.special2=e.special2,this.immunities=e.immunities,this.notes=e.notes,this.health=e.health},c.get_real_name=function(){return this.name?this.name:this.class},c.is_boss=function(){return this.class==DECKS.Boss.class},c.set_card_piles=function(e,t){for(var n=0;n<e.length;n++)this.draw_pile[n].shuffle_next=e[n].shuffle_next,this.draw_pile[n].initiative=e[n].initiative,this.draw_pile[n].starting_lines=e[n].starting_lines;for(n=0;n<t.length;n++)this.discard[n].shuffle_next=t[n].shuffle_next,this.discard[n].initiative=t[n].initiative,this.discard[n].starting_lines=t[n].starting_lines},write_to_storage(c.name,JSON.stringify(c)),c}function m(e,t){for(var n=0;n<e.draw_pile.length;n++){e.draw_pile[n].ui.attach(t)}for(n=0;n<e.discard.length;n++){e.discard[n].ui.attach(t)}e.deck_space=t}function f(e){!function(e){e.discard.length&&(e.discard[1]&&(e.discard[1].ui.removeClass("lift"),e.discard[0].ui.addClass("lift")),e.discard[0].ui.removeClass("pull"))}(e);var t=e.deck_space;remove_child(t),m(e,t)}function h(){for(var e=document.getElementById("tableau"),t=e.getElementsByClassName("card"),n=1;n<t.length;n++)if(-1!==t[n].className.indexOf("ability")){var i=26.6*(t[n].getBoundingClientRect().height/296),a=Math.min(i,26.6);e.style.fontSize=a+"px";break}}function p(e,t){v(e,t),a.forEach((function(n){if(n!==e&&n.class==e.class){n.get_real_name();v(n,t),n.set_card_piles(e.draw_pile,e.discard)}}))}function v(e,t){t&&(e.draw_pile=e.draw_pile.concat(e.discard),e.discard=[]),shuffle_list(e.draw_pile);for(var n=0;n<e.draw_pile.length;n++){var i=e.draw_pile[n];i.ui.removeClass("lift"),i.ui.removeClass("pull"),i.ui.flip_up(!1),i.ui.removeClass("discard"),i.ui.addClass("draw"),i.ui.set_depth(-n-6)}}function g(e){for(var t=0;t<e.discard.length;t++){(n=e.discard[t]).ui.removeClass("lift"),n.ui.removeClass("pull"),n.ui.push_down()}var n;e.discard.length>0&&e.discard[0].ui.addClass("lift"),E(n=e.draw_pile.shift(n),pull_animation=!0),e.discard.unshift(n)}function E(e,t){e.ui.set_depth(-3),t&&e.ui.addClass("pull"),e.ui.flip_up(!0),e.ui.removeClass("draw"),e.ui.addClass("discard")}function b(e){e.must_reshuffle()?p(e,!0):a.forEach((function(t){t.class==e.class&&(t.draw_top_card(),g(t))})),write_to_storage(e.name,JSON.stringify(e))}function k(e){e.clean_discard_pile(),p(e,!0),document.body.dispatchEvent(new CustomEvent(c.MODIFIER_DECK_SHUFFLE_REQUIRED,{detail:{shuffle:!1}}))}function S(e){e.clean_advantage_deck(),e.must_reshuffle()?k(e):(g(e),document.body.dispatchEvent(new CustomEvent(c.MODIFIER_CARD_DRAWN,{detail:{card_type:e.discard[0].card_type,count:e.count(e.discard[0].card_type)}})),e.shuffle_end_of_round()&&document.body.dispatchEvent(new CustomEvent(c.MODIFIER_DECK_SHUFFLE_REQUIRED,{detail:{shuffle:!0}}))),write_to_storage("modifier_deck",JSON.stringify(e))}function C(e){var t;1==e.draw_pile.length?(S(e),t=e.discard[0],k(e),E(t=e.draw_pile.shift(t),pull_animation=!1),e.discard.unshift(t),S(e)):0==e.draw_pile.length?(e.clean_advantage_deck(),k(e),S(e),t=e.discard[0],S(e)):(S(e),t=e.discard[0],S(e)),e.discard[0].ui.addClass("right"),t.ui.addClass("left"),e.advantage_to_clean=!0}function y(e){return{ui:new d(function(e){var t=document.createElement("img");t.className="cover",t.src=e;var n=document.createElement("div");return n.className="card modifier front",n.appendChild(t),n}(e.image),function(){var e=document.createElement("div");return e.className="card modifier back",e}()),card_type:e.type,shuffle_next_round:e.shuffle}}function w(){s.shuffle_end_of_round()&&(s.clean_advantage_deck(),k(s)),write_to_storage("modifier_deck",JSON.stringify(s))}function T(e,t){var n=document.getElementById("tableau");document.getElementById("currentdeckslist").innerHTML="";var i=a.filter((function(n){return!t||0==e.filter((function(e){return e.name==n.name&&e.level==n.level})).length})),r=e.filter((function(e){return!t||0==a.filter((function(t){return e.name==t.name&&e.level==t.level})).length}));if(s)t||(n.removeChild(document.getElementById("modifier-container")),I(),O(n,s,t));else if(I(),O(n,s,t),t){for(var l=JSON.parse(get_from_storage("modifier_deck")),d=N("curse",l),o=N("bless",l),u=0;u<o;u++)s.add_card("bless");for(u=0;u<d;u++)s.add_card("curse");s.draw_top_discard(),document.body.dispatchEvent(new CustomEvent(c.MODIFIER_DECK_SHUFFLE_REQUIRED,{detail:{shuffle:s.shuffle_end_of_round()}}))}write_to_storage("modifier_deck",JSON.stringify(s)),i.forEach((function(e){e.discard_deck()})),r.forEach((function(e){var i,s,r=e.get_real_name().replace(/\s+/g,""),l=document.createElement("div");l.id=r,l.addEventListener("contextmenu",(function(e){this.className="hiddendeck",e.preventDefault()}),!1),l.className="card-container",l.title="Click to draw enemy ability",n.appendChild(l),m(e,l),p(e,!t),l.onclick=b.bind(null,e),e.discard_deck=function(){var e=a.indexOf(this);e>-1&&a.splice(e,1),n.removeChild(l)},e.is_boss()?"Boss"!=e.get_real_name()&&e.set_stats_boss((i=e.get_real_name(),s=e.level,i=i.replace("Boss: ",""),{attack:[MONSTER_STATS.bosses[i].level[s].attack],move:[MONSTER_STATS.bosses[i].level[s].move],range:[MONSTER_STATS.bosses[i].level[s].range],special1:MONSTER_STATS.bosses[i].level[s].special1,special2:MONSTER_STATS.bosses[i].level[s].special2,immunities:MONSTER_STATS.bosses[i].level[s].immunities,notes:MONSTER_STATS.bosses[i].level[s].notes,health:[MONSTER_STATS.bosses[i].level[s].health]})):e.set_stats_monster(function(e,t){return{attack:[MONSTER_STATS.monsters[e].level[t].normal.attack,MONSTER_STATS.monsters[e].level[t].elite.attack],move:[MONSTER_STATS.monsters[e].level[t].normal.move,MONSTER_STATS.monsters[e].level[t].elite.move],range:[MONSTER_STATS.monsters[e].level[t].normal.range,MONSTER_STATS.monsters[e].level[t].elite.range],attributes:[MONSTER_STATS.monsters[e].level[t].normal.attributes,MONSTER_STATS.monsters[e].level[t].elite.attributes],health:[MONSTER_STATS.monsters[e].level[t].normal.health,MONSTER_STATS.monsters[e].level[t].elite.health]}}(e.get_real_name(),e.level)),p(e),t?e.draw_top_discard():f(e),a.push(e);var c=document.getElementById("currentdeckslist"),d=document.createElement("li");d.className="currentdeck",c.appendChild(d);var o=document.createElement("a");o.id="switch-"+r,o.href="#switch-"+r,o.innerText=e.get_real_name(),o.title="Click to show/hide deck",o.addEventListener("click",(function(e){var t=document.getElementById(this.id.replace("switch-",""));t.className="hiddendeck"==t.className?"card-container":"hiddendeck"}),!1),d.appendChild(o)})),h()}function I(){s=function(){var e={name:"Monster modifier deck",type:l.MODIFIER,draw_pile:[],discard:[],advantage_to_clean:!1,draw_top_discard:function(){if(this.discard.length>0){var e=this.discard[this.discard.length-1];e.ui.set_depth(-3),e.ui.addClass("pull"),e.ui.flip_up(!0),e.ui.removeClass("draw"),e.ui.addClass("discard")}f(this)}};e.count=function(e){return this.draw_pile.filter((function(t){return t.card_type===e})).length}.bind(e),e.remove_card=function(t){for(var n=0;n<e.draw_pile.length;n++)if(e.draw_pile[n].card_type==t){e.draw_pile.splice(n,1),p(e,!1),f(e);break}return write_to_storage("modifier_deck",JSON.stringify(s)),this.count(t)}.bind(e),e.add_card=function(t){return this.count(t)<10&&(e.draw_pile.push(y(MODIFIER_CARDS[t.toUpperCase()])),f(e),p(e,!1)),write_to_storage("modifier_deck",JSON.stringify(s)),this.count(t)}.bind(e),e.shuffle_end_of_round=function(){return this.discard.filter((function(e){return e.shuffle_next_round})).length>0}.bind(e),e.must_reshuffle=function(){return!this.draw_pile.length}.bind(e),e.clean_discard_pile=function(){for(var t=0;t<e.discard.length;t++)this.discard[t].card_type!=CARD_TYPES_MODIFIER.BLESS&&this.discard[t].card_type!=CARD_TYPES_MODIFIER.CURSE||(this.discard.splice(t,1),t--);f(this)}.bind(e),e.clean_advantage_deck=function(){e.advantage_to_clean&&e.discard[1]&&(e.advantage_to_clean=!1,e.discard[0].ui.removeClass("right"),e.discard[0].ui.removeClass("left"),e.discard[1].ui.removeClass("left"),e.discard[1].ui.removeClass("left"))}.bind(e);var t=JSON.parse(get_from_storage("modifier_deck"));return MODIFIER_DECK.forEach((function(n){var i=y(n);t&&function(e,t){for(var n=0;n<e.length;n++)if(e[n].card_type===t)return e.splice(n,1);return null}(t.discard,i.card_type)?e.discard.push(i):e.draw_pile.push(i)})),e}()}function N(e,t){var n=0;if(t)for(var i=0;i<t.draw_pile.length;i++)t.draw_pile[i].card_type===e&&n++;return n}function O(e,t,n){function i(e,t,n,i){function a(t,n,i,a){var s=document.createElement("div");return s.className=t+" button",s.innerText=n,s.onclick=function(){a.innerText=i(e)},s}var s=document.createElement("div");s.className="counter-icon",s.title=i;var r=document.createElement("div");r.className="background "+e,s.appendChild(r);var l=document.createElement("div");return l.className="icon-text",l.innerText="0",s.appendChild(a("decrement","-",n,l)),s.appendChild(l),s.appendChild(a("increment","+",t,l)),document.body.addEventListener(c.MODIFIER_CARD_DRAWN,(function(t){t.detail.card_type===e&&(l.innerText=t.detail.count)})),s}var a=document.createElement("div");a.className="card-container",a.id="modifier-container";var r=document.createElement("div");r.className="modifier-deck-column-1",r.appendChild(i("bless",t.add_card,t.remove_card,"Bless cards")),r.appendChild(i("curse",t.add_card,t.remove_card,"Curse cards"));var l=document.createElement("div");l.className="counter-icon shuffle not-required",l.onclick=w,l.title="Click to end round and shuffle",document.body.addEventListener(c.MODIFIER_DECK_SHUFFLE_REQUIRED,(function(e){e.detail.shuffle?window.setTimeout((function(){l.className="counter-icon shuffle"}),400):l.className="counter-icon shuffle not-required"}));var d=document.createElement("div");d.className="modifier-deck-column-2";var o=document.createElement("div");o.className="card-container modifier",o.title="Click to draw one card";var u=document.createElement("div");u.className="button draw-two",u.onclick=C.bind(null,s),u.title="Click to draw two cards",d.appendChild(o),d.appendChild(u),d.appendChild(l),a.appendChild(d),a.appendChild(r),e.appendChild(a),m(t,o),p(t,!n),o.onclick=S.bind(null,t)}function R(e,t){var n={};n.html=t?document.createElement("span"):document.createElement("ul"),n.html.className="selectionlist";var i=t?document.createElement("label"):document.createElement("li");i.innerText=e,n.html.appendChild(i);var a=create_input("number","scenario_number","1","");return a.input.min=0,a.input.max=7,n.html.appendChild(a.input),n.spinner=a.input,n.get_selection=function(){return this.spinner.value>7?7:this.spinner.value},n.set_value=function(e){this.spinner.value=e>7?7:e},n}function x(){var e={};e.ul=document.createElement("ul"),e.ul.className="selectionlist",e.checkboxes={},e.level_selectors={},e.global_level_selector=null;var t=document.createElement("li"),n=new R("Select global level ",!0);t.appendChild(n.html),e.global_level_selector=n;var i=create_input("button","applylevel","Apply All","");for(key in i.input.onclick=function(){for(key in e.level_selectors)e.level_selectors[key].set_value(e.global_level_selector.get_selection())},t.appendChild(i.root),e.ul.appendChild(t),DECKS){var a=DECKS[key].name;t=document.createElement("li"),i=create_input("checkbox","deck",a,a);t.appendChild(i.root);var s=new R(" with level ",!0);t.appendChild(s.html),e.ul.appendChild(t),e.checkboxes[a]=i.input,e.level_selectors[a]=s}return e.get_selection=function(){return dict_values(this.checkboxes).filter(is_checked).map(input_value)},e.get_selected_decks=function(){var t=this.get_selection();return concat_arrays(t.map(function(t){var n=t in DECKS?DECKS[t]:[];return n.level=e.level_selectors[t].get_selection(),n}.bind(this)))},e.set_selection=function(t){dict_values(this.checkboxes).forEach((function(e){e.checked=!1})),t.forEach(function(t){var n=this.checkboxes[t.name];n&&(n.checked=!0,e.level_selectors[t.name].set_value(t.level))}.bind(this))},e}function D(e){var t={};t.ul=document.createElement("ul"),t.ul.className="selectionlist",t.spinner=null,t.decks={},t.special_rules={},t.level_selector=null,t.level_selector=new R("Select level",!1),t.ul.appendChild(t.level_selector.html);for(var n=0;n<e.length;n++){var i=e[n];t.decks[n]=i.decks,t.special_rules[n]=i.special_rules?i.special_rules:""}var a=document.createElement("li");a.innerText="Select scenario number",t.ul.appendChild(a);var s=create_input("number","scenario_number","1","");return s.input.min=1,s.input.max=e.length,t.ul.appendChild(s.input),t.spinner=s.input,t.get_selection=function(){var n=t.spinner.value-1;return Math.min(n,e.length+1)},t.get_level=function(e,n){var i=t.level_selector.get_selection();return n.indexOf(SPECIAL_RULES.living_corpse_two_levels_extra)>=0&&e==SPECIAL_RULES.living_corpse_two_levels_extra.affected_deck?Math.min(7,parseInt(i)+parseInt(SPECIAL_RULES.living_corpse_two_levels_extra.extra_levels)):i},t.get_scenario_decks=function(){return this.decks[this.get_selection()].map((function(e){return DECKS[e.name]?e.class=DECKS[e.name].class:-1!=e.name.indexOf("Boss")&&(e.class=DECKS.Boss.class),e.level=t.get_level(e.name,t.get_special_rules()),e}))},t.get_special_rules=function(){return this.special_rules[this.get_selection()]},t}function M(e,t,n){var i;for(i in e)e[i].className=i==n?"":"inactive";for(i in t)t[i].className=i==n?"tabbody":"inactive tabbody"}function A(e,t,n){e.className=n?"pane":"pane inactive",t.style.display=n?"initial":"none"}document.addEventListener("DOMContentLoaded",(function(){var e,t,n,i,s,r,l,c;e=document.getElementById("deckspage"),t=document.getElementById("scenariospage"),n=document.getElementById("applydecks"),i=document.getElementById("applyscenario"),s=document.getElementById("applyload"),r=document.getElementById("showmodifierdeck"),l=new x,c=new D(SCENARIO_DEFINITIONS),e.insertAdjacentElement("afterbegin",l.ul),t.insertAdjacentElement("afterbegin",c.ul),n.onclick=function(){localStorage.clear();var e=l.get_selected_decks();write_to_storage("selected_deck_names",JSON.stringify(e)),T(e.map((function(e){return _(e.class,e.name,e.level)})),!0);var t=document.getElementById("showmodifierdeck-deckspage"),n=document.getElementById("modifier-container");t.checked?n.style.display="block":n.style.display="none"},i.onclick=function(){try{localStorage.clear()}catch(e){return void console.error("Local storage is required")}var e=c.get_scenario_decks();write_to_storage("selected_deck_names",JSON.stringify(e)),l.set_selection(e),T(e.map((function(e){return _(e.class,e.name,e.level)})),!1);var t=document.getElementById("modifier-container");r.checked?t.style.display="block":t.style.display="none",show_settingspane(settingspane,cancelarea,!1)},s.onclick=function(){var e=JSON.parse(get_from_storage("selected_deck_names"));l.set_selection(e),T(e.map((function(e){return _(e.class,e.name,e.level)})),!0);var t=document.getElementById("modifier-container");r.checked?t.style.display="block":t.style.display="none"},window.onresize=h.bind(null,a),function(){var e={scenarios:document.getElementById("scenariotab"),decks:document.getElementById("deckstab")},t={scenarios:document.getElementById("scenariospage"),decks:document.getElementById("deckspage")},n=document.getElementById("settingspane"),i=document.getElementById("settingsbtn"),a=document.getElementById("cancelarea");scenariotab.onclick=function(n){M(e,t,"scenarios")},deckstab.onclick=function(n){M(e,t,"decks")},i.onclick=function(e){A(n,a,!0)},a.onclick=function(e){A(n,a,!1)},M(e,t,"scenarios")}()}))}]);